#!/bin/sh
# Compile and run a JS program
# $1 = filename
# $2 = extension (unused)

mkdir .cache
export DENO_DIR=$(pwd)/.cache

cp "$1" main.js
ECODE=$(timeout -s KILL "$KAMELI_TIMELIMIT" s6-softlimit -a "$KAMELI_MEMLIMIT" -f "$KAMELI_FILELIMIT" -p "$KAMELI_PROCESSLIMIT" deno run main.js)
killall -9 -u "$(whoami)" > /dev/null
exit $ECODE
