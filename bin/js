#!/bin/sh
# Compile and run a JS program
# $1 = filename
# $2 = extension (unused)

mkdir .cache
export DENO_DIR=$(pwd)/.cache
chmod 0777 "$DENO_DIR"

cp "$1" main.js
sudo -u "$KAMELI_RUNUSER" DENO_DIR="$DENO_DIR" timeout -s KILL "$KAMELI_TIMELIMIT" deno run main.js
ECODE=$?
killall -9 -u "$KAMELI_RUNUSER" > /dev/null
exit $ECODE
